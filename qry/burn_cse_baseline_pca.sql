SELECT DISTINCT
	ENCNTR_ALIAS.ALIAS AS FIN,
	CLINICAL_EVENT.EVENT_ID AS EVENT_ID,
	TO_CHAR(pi_from_gmt(CLINICAL_EVENT.EVENT_END_DT_TM, (pi_time_zone(1, @Variable('BOUSER')))), 'YYYY-MM-DD"T"HH24:MI:SS') AS EVENT_DATETIME,
	pi_get_cv_display(CLINICAL_EVENT.EVENT_CD) AS EVENT,
	CLINICAL_EVENT.RESULT_VAL AS RESULT
FROM
    CLINICAL_EVENT,
	ENCNTR_ALIAS,
	ENCOUNTER
WHERE
    ENCNTR_ALIAS.ALIAS IN @prompt('Enter value(s) for Alias','A',,Multi,Free,Persistent,,User:0)
	AND ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD = 619
	AND ENCNTR_ALIAS.ENCNTR_ID = ENCOUNTER.ENCNTR_ID
	AND (
		CLINICAL_EVENT.EVENT_CD IN (
			1353917535, -- PCA Clinician Bolus
			1353917564, -- PCA Clinician Bolus Unit
			700103069, -- PCA Concentration
			700103420, -- PCA Continuous Rate Dose
			700103515, -- PCA Demand Dose
			700103573, -- PCA Demand Dose Unit
			1353917859, -- PCA Doses Delivered
			900876112, -- PCA Drug
			802776519, -- PCA Loading Dose
			700103330, -- PCA Lockout Interval (minutes)
			700104137, -- PCA Number of Attempts
			700104271, -- PCA Number of Injections
			900876333, -- PCA Number of Undelivered Attempts
			900876210 -- PCA Total Demands
		)
	    AND ENCOUNTER.PERSON_ID = CLINICAL_EVENT.PERSON_ID
		AND CLINICAL_EVENT.VALID_UNTIL_DT_TM > DATE '2099-12-31'
	    AND ENCOUNTER.ENCNTR_ID = CLINICAL_EVENT.ENCNTR_ID
		AND CLINICAL_EVENT.EVENT_CLASS_CD IN (
			159, -- NUM
			162 -- TXT
		)
	)
