---
title: "Cathflo (Alteplase) Utilization"
author: "Brian Gulbis, PharmD, BCPS"
date: 'Updated on: `r format(Sys.Date(), "%B %d, %Y")`'
output: 
    html_document:
        code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

```{r}
library(tidyverse)
library(lubridate)
library(edwr)
library(plotly)

dir_raw <- "../data/raw/2018-05_cathflo"

# run MBO query
#   * Patients - by Medication (Generic)
#       - Facility (Curr): HH HERMANN;HH Trans Care;HH Rehab;HH Clinics
#       - Medication (Generic): alteplase
#       - Admit date: 2/1/2018 - 4/30/2018

pts <- read_data(dir_raw, "patients", FALSE) %>%
    as.patients()

mbo_pts <- concat_encounters(pts$millennium.id)

# run MBO query
#   * Medications - Inpatient - Prompt
#       - Medication (Generic): alteplase

meds <- read_data(dir_raw, "meds-inpt", FALSE) %>%
    as.meds_inpt() %>%
    filter(
        is.na(event.tag),
        med.dose == 1 | med.dose == 2
    ) 

```

```{r, fig.cap="Number of 1mg and 2mg doses given over a 3 month period"}
meds %>%
    count(med.dose) %>%
    mutate_at("med.dose", factor) %>%
    plot_ly() %>%
    add_bars(x = ~med.dose, y = ~n) %>%
    layout(
        xaxis = list(title = "Dose (mg)"),
        yaxis = list(title = "Number of doses")
    )
```

